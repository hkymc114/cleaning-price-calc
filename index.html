<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç™½æ´‹èˆã€€ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ–™é‡‘è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€€</title>
  <!-- Site Icons / PWA meta -->
  <link rel="icon" href="/icons/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#0b6dd6">
  <meta name="msapplication-TileColor" content="#0b6dd6">
  <meta name="theme-color" content="#0b6dd6">
  <style>
    :root{
      --bg:#f4f8fb;--card:#ffffff;--line:#d8e2ee;--muted:#6b7a90;--accent:#0b6dd6;--accent-2:#e6f0f8;--danger:#b00020;
      --chip-bg:#eef5ff;--chip-text:#084c9e;--shadow:0 6px 24px rgba(15,35,65,.06);
    }
    *{box-sizing:border-box}
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; padding: 20px; margin: 0; background-color: var(--bg); color:#0b1220; }
    h1 { font-size: 1.4em; margin: 0 0 12px; }

    .toolbar { background: var(--card); border: 1px solid var(--line); border-radius: 12px; padding: 14px; box-shadow: var(--shadow); }
    .form-group { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    label{font-size:.95em; color:#0f2748}
    select, button, input[type="search"] { font-size: 1em; padding: 12px 14px; border:1px solid var(--line); border-radius: 10px; background:#fff; }
    button { cursor: pointer; }
    .btn-primary{ background: var(--accent); color:#fff; border: none; }
    .btn-ghost{ background:#fff; color:#0b1220; }
    .btn-danger{ background: var(--danger); color:#fff; border:none; }

    /* === è¡¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ãƒ©ãƒƒãƒ‘ === */
    .table-wrap{ border:1px solid var(--line); border-radius:12px; background:var(--card); box-shadow: var(--shadow); overflow:auto; max-height:60vh; }
    table { border-collapse: collapse; width: 100%; margin: 0; }
    thead th { position: sticky; top: 0; background: #f8fbff; z-index: 2; }
    th, td { border-bottom: 1px solid var(--line); padding: 10px; text-align: left; font-size: 0.95em; white-space: nowrap; }
    th:nth-child(1), td:nth-child(1){min-width:180px}
    th:nth-child(4), td:nth-child(4){min-width:220px}

    .chips{display:flex; flex-wrap:wrap; gap:6px; align-items:center}
    .chip{background:var(--chip-bg); color:var(--chip-text); padding:4px 8px; border-radius:999px; font-size:.85em; border:1px solid #d3e5ff}

    #summary { margin-top: 10px; font-weight: bold; font-size: 1.05em; }
    #total { font-weight: bold; font-size: 1.2em; }

    .actions{display:flex; gap:8px}

    @media (min-width: 720px) { select, button, input[type="search"] { flex: initial; } .form-group { flex-wrap: nowrap; } }

    #itemSearch { width: clamp(220px, 35vw, 420px); }

    .section { margin-top: 12px; display:flex; gap:10px; align-items:center }

    /* ===== ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æ¡ˆå†…UI ===== */
    .guide-box{ border:1px solid var(--line); border-radius:12px; padding:12px; background:var(--card); box-shadow:var(--shadow); }
    .guide-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .guide-desc{ margin-top:8px; padding:10px; background:#ffffff; border-left:3px solid var(--accent); border-radius:8px; white-space:pre-line }

    /* ãƒ‰ãƒ­ãƒ¯ãƒ¼ */
    .drawer-overlay{ position: fixed; inset:0; background: rgba(4,18,35,.35); display:none; z-index: 40; }
    .drawer{ position: fixed; top:0; right:-460px; width:min(92vw,440px); height:100dvh; background:#fff; box-shadow:-8px 0 30px rgba(12,24,48,.12); border-left:1px solid var(--line); z-index: 41; transition: right .25s ease; display:flex; flex-direction:column }
    .drawer.open{ right:0 }
    .drawer-header{ padding:16px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center }
    .drawer-title{ font-size:1.05em; font-weight:700 }
    .drawer-body{ padding:14px; overflow:auto; overscroll-behavior:contain; -webkit-overflow-scrolling:touch; padding-block-start:8px; padding-bottom:16px }
    .drawer-footer{ text-align:center; font-size:.8em; color:#6a7492; padding:12px 0 calc(12px + env(safe-area-inset-bottom)); border-top:1px solid var(--line); background:#fff }
    .drawer-body::after{ content:""; display:block; height:16px; }

    .proc-group{ margin-bottom:14px; }
    .proc-title{ font-weight:700; margin-bottom:8px }
    .proc-row{ display:flex; justify-content:space-between; gap:10px; align-items:center; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fafcff; flex-wrap:nowrap; }
    .proc-row label span{ white-space:nowrap; }
    .proc-row.disabled{ opacity:.5 }
    .proc-meta{ font-size:.85em; color:var(--muted) }
    .proc-controls{ display:flex; gap:8px; align-items:center; margin-left:auto; min-width:120px; }
    .hint{ font-size:.85em; color:var(--muted) }

    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#f1f5fb; border:1px solid #e2e8f0; padding:2px 6px; border-radius:6px }

    footer{ text-align:center; font-size: .8em; color:#6a7492; margin-top: 26px; }
    select[data-proc-opt]{ width:100%; max-width:200px; }
  </style>
</head>
<body>
 <h1>ç™½æ´‹èˆ æ–™é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>

<!-- ä½¿ã„æ–¹ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç›´ä¸‹ã«æ–°è¨­ï¼‰ -->
<details class="howto" style="margin: 10px 0 14px;">
  <summary style="cursor:pointer; font-weight:700;">ä½¿ã„æ–¹</summary>
  <div style="margin-top:8px; line-height:1.7;">
    <ol style="margin:0; padding-left:1.2em;">
      <li>ã€Œå“åæ¤œç´¢ã€ã«å“ç›®åã‚’å…¥åŠ›ã—ã€å€™è£œã‹ã‚‰é¸æŠã—ã¾ã™ã€‚</li>
      <li>å¿…è¦ã«å¿œã˜ã¦ã€Œä»•ä¸Šã’ç¨®åˆ¥ã€ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ï¼ˆä¾‹ï¼šæ™®é€šæ´—ã„(ãƒ‰ãƒ©ã‚¤/æ°´å…±é€š)ï¼ã€Œã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘ã€ã€å¸ƒå›£æ´—ã„ï¼ã€Œå¸ƒå›£æ–™é‡‘ã€ï¼‰ã€‚</li>
      <li>ã€Œæ¤œç´¢ã‹ã‚‰è¿½åŠ ã€ã‚’æŠ¼ã—ã¦è¡¨ã«é …ç›®ã‚’è¿½åŠ ã—ã¾ã™ã€‚é‡‘é¡ã®å³ã«ã‚ã‚‹ã€ŒåŠ å·¥ã‚’ç·¨é›†ã€ã§åŠ å·¥ã‚’è¿½åŠ ã§ãã¾ã™ã€‚</li>
    </ol>
  </div>
</details>

<div class="toolbar">
  <div class="form-group">
    <!-- â€» ä¿ƒã—æ–‡ï¼ˆsearch-hintï¼‰ã‚’å‰Šé™¤ -->
    <label for="itemSearch">ğŸ” å“åæ¤œç´¢:</label>
    <input id="itemSearch" type="search" list="itemSuggestions" placeholder="å“åã‚’å…¥åŠ›ã—ã¦é¸æŠ" />
    <datalist id="itemSuggestions"></datalist>

    <label for="typeSelect">ä»•ä¸Šã’ç¨®åˆ¥:</label>
    <select id="typeSelect">
      <option value="ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘">ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘</option>
      <option value="ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘">ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘</option>
      <option value="ç´ æåˆ¥æ–™é‡‘">ç´ æåˆ¥æ–™é‡‘</option>
      <option value="ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘">ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘</option>
      <option value="å’Œæ´—æ–™é‡‘">å’Œæ´—æ–™é‡‘</option>
      <option value="å¸ƒå›£æ–™é‡‘">å¸ƒå›£æ–™é‡‘</option>
    </select>

    <button id="addSearchBtn" class="btn-primary">æ¤œç´¢ã‹ã‚‰è¿½åŠ </button>
    <button id="resetBtn" class="btn-ghost">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>

  

  <!-- è¡¨ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã‚‹ãŸã‚ã«ãƒ©ãƒƒãƒ‘ã‚’è¿½åŠ  -->
  <div class="table-wrap" id="tableWrap">
    <table>
      <thead>
        <tr>
          <th>å“ç›®</th>
          <th>ç¨®åˆ¥</th>
          <th>é‡‘é¡ï¼ˆåŸºæº–ï¼‰</th>
          <th>åŠ å·¥</th>
          <th>å°è¨ˆ</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <p id="summary">åˆè¨ˆé‡‘é¡(ç¨æŠœ): <span id="total">0</span> å††</p>

  <!-- â–¼â–¼ å„ç¨®åŠ å·¥ã®ã”æ¡ˆå†…ã‚’ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³åŒ–ï¼ˆä¸­ã«ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰ â–¼â–¼ -->
<div style="margin-top: 24px;">
  <details class="howto" id="processingGuideAccordion">
    <summary style="cursor:pointer; font-weight:700;">å„ç¨®åŠ å·¥ã®ã”æ¡ˆå†…</summary>
    <div class="guide-box" style="margin-top:10px;">
      <div class="guide-row">
        <label for="processingInfoSelect">åŠ å·¥ã‚’é¸æŠ:</label>
        <select id="processingInfoSelect">
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        </select>
      </div>
      <pre id="processingInfoText" class="guide-desc"></pre>
    </div>
  </details>
</div>

  <!-- ãƒ‰ãƒ­ãƒ¯ãƒ¼ -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  <aside class="drawer" id="drawer">
    <div class="drawer-header">
      <div>
        <div class="drawer-title" id="drawerTitle">åŠ å·¥ã®ç·¨é›†</div>
        <div class="hint" id="drawerSubtitle"></div>
      </div>
      <button id="drawerClose" class="btn-ghost">é–‰ã˜ã‚‹</button>
    </div>
    <div class="drawer-body">
      <div class="hint" id="drawerBaseInfo"></div>

      <div class="proc-group">
        <div class="proc-title">50%åŠ ç®—ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘åŸºæº–ã€æœ€ä½400ï¼ä¸Šé™2500ï¼‰</div>
        <div id="procPercentList" class="proc-list"></div>
      </div>

      <div class="proc-group">
        <div class="proc-title">å›ºå®šé¡</div>
        <div id="procFixedList" class="proc-list"></div>
      </div>

      <div class="proc-group">
        <div class="proc-title">æŠ˜ã‚Šç›®åŠ å·¥</div>
        <div id="procConditionalList" class="proc-list"></div>
      </div>

      <div class="proc-group">
        <div class="proc-title">è¨ˆç®—çµæœ</div>
        <div class="proc-row">
          <div>
            <div>åŠ å·¥å°è¨ˆ</div>
            <div class="hint" id="procCalcNote">â€»ä¸‹é™ãƒ»ä¸Šé™ã‚’é©ç”¨</div>
          </div>
          <div style="font-weight:700">+ <span id="procSubtotal">0</span> å††</div>
        </div>
        <div class="proc-row">
          <div>è¡Œå°è¨ˆï¼ˆåŸºæº–ï¼‹åŠ å·¥ï¼‰</div>
          <div style="font-weight:700"><span id="rowLineTotal">0</span> å††</div>
        </div>
      </div>
    </div>
    <div class="drawer-footer">
      <button class="btn-ghost" id="drawerCancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn-primary" id="drawerSave">ä¿å­˜</button>
    </div>
  </aside>

<footer>
  Â© 2025 ç™½æ´‹èˆæ–™é‡‘è¨ˆç®—ã‚¢ãƒ—ãƒª Ver.2.2.0<br />
  <details style="margin-top: 6px;">
    <summary>ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæƒ…å ±</summary>
    <div style="text-align: left; margin: 0 auto;">
      <ul style="padding-left: 1.2em; line-height: 1.6;">
        <li>2025/11/08 âˆ’ Ver.2.2.0 ä½¿ã„æ–¹èª¬æ˜å®Ÿè£…</li>
        <li>2025/11/03 âˆ’ Ver.2.1.1 å„ç¨®åŠ å·¥æ¡ˆå†…æ–‡èª¿æ•´</li>
        <li>2025/11/03 âˆ’ Ver.2.1.0 åŠ å·¥è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…</li>
        <li>2025/07/14 âˆ’ Ver.1.2.1 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¿®æ­£</li>
        <li>2025/07/13 âˆ’ Ver.1.1.0 åŠ å·¥å“è¿½åŠ </li>
        <li>2025/07/12 âˆ’ Ver.1.0.0 åˆç‰ˆãƒªãƒªãƒ¼ã‚¹</li>
      </ul>
    </div>
  </details>

  <div style="font-size: 0.9em; color: #6a7492;">
    <p style="margin-bottom: 6px;">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSc8vJGvkT8UDnnF-yNxAyufkNQd49g7wuOxKE7tE0S5mHW0EQ/viewform?usp=dialog"
         target="_blank"
         rel="noopener noreferrer"
         style="color:#0066cc; text-decoration:underline;">
        ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã“ã¡ã‚‰
      </a>
    </p>
    <p>
      ç™½æ´‹èˆ å…¬å¼ã‚µã‚¤ãƒˆï¼š
      <a href="https://www.hakuyosha.co.jp/" target="_blank" rel="noopener noreferrer">
        https://www.hakuyosha.co.jp/
      </a>
    </p>
  </div>
</footer>

  <!-- =============================================
  â–¼â–¼â–¼ ã“ã“ã‹ã‚‰JavaScriptï¼ˆé‡è¦å‡¦ç†ã”ã¨ã®è§£èª¬å…¥ã‚Šï¼‰ â–¼â–¼â–¼
  ============================================= -->
<script>
  // =====================================================
  // â–¼ åŠ å·¥èª¬æ˜ï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰
  //   ç›®çš„ï¼šèª¬æ˜ãƒ»å•ã„åˆã‚ã›å¯¾å¿œæ™‚ã«ã€åŠ å·¥ã®æ ¹æ‹ ï¼ˆ%ï¼å›ºå®šï¼æ¡ä»¶ï¼‰ã‚’å¯è¦–åŒ–
  //   é‹ç”¨ï¼šæ–‡è¨€å¤‰æ›´ã¯ã“ã“ï¼ˆprocessingDataDescï¼‰ã€‚è¨ˆç®—æ ¹æ‹ ã¯ä¸‹ã® PROC_MASTER ã‚’ä¿®æ­£
  // =====================================================
  const processingDataDesc = [
    { name: "é˜²è™«åŠ å·¥", description: `ãƒ‹ã‚ªã‚¤ãŒãªãã€è‰²ã‚„é¢¨åˆã„ã‚‚å¤‰ã‚ã‚‰ãªã„é˜²è™«åŠ¹æœã«å„ªã‚ŒãŸåŠ å·¥ã§ã™ã€‚
è™«å®³ã«é­ã„ã‚„ã™ã„ã‚¦ãƒ¼ãƒ«ã‚„ã‚«ã‚·ãƒŸãƒ¤ç´ æã®ã‚»ãƒ¼ã‚¿ãƒ¼ã€ã‚³ãƒ¼ãƒˆã€ã‚¹ãƒ¼ãƒ„ãªã©ã«ãŠå‹§ã‚ã§ã™ã€‚` },
    { name: "ã¯ã£æ°´åŠ å·¥", description: `ã¯ã£æ°´æ€§ã¨é€šæ°—æ€§ã‚’ä¸¡ç«‹ã—ãŸåŠ å·¥ã§ã™ã€‚æ€¥ãªé›¨ã‚„ã€é£²æ–™ãªã©ã®æ±šã‚Œã‹ã‚‰è¡£é¡ã‚’å®ˆã‚Šã¾ã™ã€‚
ãƒˆãƒ¬ãƒ³ãƒã‚³ãƒ¼ãƒˆã‚„ã‚¹ãƒ¼ãƒ„ã€ãƒã‚¯ã‚¿ã‚¤ã«ã‚‚ãŠã™ã™ã‚ã§ã™ã€‚` },
    { name: "æ±—ã™ã£ãã‚ŠåŠ å·¥", description: `ãƒ‰ãƒ©ã‚¤ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã®è‰¯ã•ã¯ãã®ã¾ã¾ã«ã€æ±—ãªã©ã®æ°´æº¶æ€§æ±šã‚Œã‚’ã‚ˆãè½ã¨ã™åŠ å·¥ã§ã™ã€‚æ±—ã«ã‚ˆã‚‹ã‚´ãƒ¯ã‚´ãƒ¯æ„ŸãŒç„¡ããªã‚Šã€ã‚¹ãƒƒã‚­ãƒªã—ãªã‚„ã‹ãªé¢¨åˆã„ã«ä»•ä¸ŠãŒã‚Šã¾ã™ã€‚
æ°´æ´—ã„ãŒã§ããªã„å¤ç‰©è¡£é¡ãªã©ã€æ±—æ±šã‚ŒãŒæ°—ã«ãªã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã«ãŠã™ã™ã‚ã§ã™ã€‚` },
    { name: "ãƒãƒªã‚¸ãƒ³ãƒ»ã‚¦ã‚©ãƒƒã‚·ãƒ¥ã‚¤ãƒ³åŠ å·¥â€»", description: `éŠ€ã‚¤ã‚ªãƒ³ã®ãƒã‚«ãƒ©ã§è¡£é¡è¡¨é¢ã®ç´°èŒã®å¢—æ®–ã‚’é˜²ãã€æ±—ãªã©ã®ç´°èŒç”±æ¥ã®ãƒ‹ã‚ªã‚¤ã®ç™ºç”Ÿã‚’æŠ‘ãˆã¾ã™ã€‚
ã‚·ãƒ£ãƒ„ã‚„ãƒ–ãƒ©ã‚¦ã‚¹ã®ã»ã‹ã€ã‚·ãƒ¼ãƒ„ã€ãµã¨ã‚“ãªã©ã®å¯å…·é¡ãªã©ã«ãŠã™ã™ã‚ã§ã™ã€‚` },
    { name: "ã—ã£ã¨ã‚ŠåŠ å·¥", description: `æ¯›è£½å“ã«ã—ã£ã¨ã‚Šæ„Ÿã‚’ä¸ãˆã‚‹åŠ å·¥ã§ã™ã€‚ç´ æã«ã‚ˆã£ã¦ã¯ã€é™é›»æ°—ãŒç”Ÿã˜ã«ãããªã‚‹åŠ¹æœã‚‚ã‚ã‚Šã¾ã™ã€‚
ãƒãƒ•ãƒ©ãƒ¼ã‚„ã‚»ãƒ¼ã‚¿ãƒ¼ã€ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³ã€ã‚³ãƒ¼ãƒˆãªã©ã«ãŠã™ã™ã‚ã§ã™ã€‚` },
    { name: "ãƒªãƒ³ãƒˆãƒ©ã‚¯åŠ å·¥", description: `ã€Œæ¨¹è„‚ã€ã‚’ç”¨ã„ã¦ã€ã‚·ãƒ£ãƒ¼ãƒ—ãªæŠ˜ç›®ã‚’ä¿ã¤åŠ å·¥ã§ã™ã€‚ã‚³ãƒƒãƒˆãƒ³ãƒ‘ãƒ³ãƒ„ã«ãŠã™ã™ã‚ã§ã™ã€‚â€»ã‚¹ã‚«ãƒ¼ãƒˆã¯ãƒªãƒ³ãƒˆãƒ©ã‚¯åŠ å·¥ã®ã¿ã¨ãªã‚Šã¾ã™ã€‚
â€»ç·ãƒ—ãƒªãƒ¼ãƒ„å“ã¯åŠ å·¥ãŒã§ãã¾ã›ã‚“ã€‚` },
    { name: "ã‚·ãƒ­ã‚»ãƒƒãƒˆåŠ å·¥", description: "ã€Œå°‚ç”¨ã®åŠ å·¥å‰¤ã€ã‚’ç”¨ã„ã¦ã€ã‚½ãƒ•ãƒˆãªæŠ˜ç›®ã‚’ä¿ã¤åŠ å·¥ã§ã™ã€‚ã‚¦ãƒ¼ãƒ«è£½å“ãŒå¯¾è±¡ã§ã™ã€‚" },
    { name: "å’Œæœã¯ã£æ°´åŠ å·¥", description: `å’Œæœã®ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒã‚¦ãƒã‚¦ã‚’æ´»ã‹ã—ã€é›¨ã‚„æ°´ã‚’ã¯ã˜ãæ±šã‚Œã‚’ä»˜ãã«ããã™ã‚‹åŠ å·¥ã§ã™ã€‚
å’Œæœã¨å¸¯ãŒå¯¾è±¡ã§ã™ã€‚` },
    { name: "æ¯›çš®é˜²è™«åŠ å·¥", description: "å¤§åˆ‡ãªæ¯›çš®è£½å“ã«ã‚‚é˜²è™«åŠ å·¥ã‚’ï¼æ¯›çš®è£½å“ã®è£åœ°ã«é˜²è™«åŠ å·¥ã‚’æ–½ã™ã“ã¨ã§ã€æ¯›çš®ã‚’è™«å®³ã‹ã‚‰å®ˆã‚Šã¾ã™ã€‚" },
    { name: "é˜²ãƒ€ãƒ‹åŠ å·¥(æ¯›å¸ƒãƒ»å¸ƒå›£ãƒ»ã˜ã‚…ã†ãŸã‚“ãªã©)", description: "ãƒ€ãƒ‹ã‚’å¯„ã›ä»˜ã‘ãªã„å¿Œé¿åŠ¹æœã§ã„ã¤ã§ã‚‚å¿«é©ãªç¡çœ ã‚’ã‚µãƒãƒ¼ãƒˆã€‚å®‰å…¨æ€§ãŒé«˜ããŠå­æ§˜ãŒã„ã‚‹ã”å®¶åº­ã§ã‚‚å®‰å¿ƒã—ã¦ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚" },
    { name: "é˜²ã‚«ãƒ“åŠ å·¥(ã‚«ãƒ¼ãƒ†ãƒ³ã®ã¿)", description: "çª“ã‚¬ãƒ©ã‚¹ã®çµéœ²ã‚„å®¤å†…å¤–ã®ãƒ›ã‚³ãƒªã€ç©ºèª¿è¨­å‚™ã®å½±éŸ¿ã§ã‚«ãƒ¼ãƒ†ãƒ³ã¯ã‚«ãƒ“ãŒç”Ÿãˆã‚„ã™ããªã£ã¦ã„ã¾ã™ã€‚æ¯æ—¥ä½¿ã†ã‚«ãƒ¼ãƒ†ãƒ³ã«æ˜¯éãŠã™ã™ã‚ã§ã™ã€‚" },
    { name: "é˜²ç‚åŠ å·¥(ã‚«ãƒ¼ãƒ†ãƒ³ã®ã¿)", description: "é˜²ç‚åŠ å·¥ã¯ç«ãŒç‡ƒãˆç§»ã£ãŸå ´åˆã§ã‚‚ç‚ã®ç™ºç”Ÿã‚’æŠ‘ãˆç«ç‚ã®å»¶ç„¼ã‚’é˜²ãã¾ã™ã€‚" }
  ];

  const guideSelect = document.getElementById('processingInfoSelect');
  const guideText = document.getElementById('processingInfoText');
  (function buildProcessingGuide(){
    processingDataDesc.forEach(item => {
      const opt = document.createElement('option');
      opt.value = item.name; opt.textContent = item.name; guideSelect.appendChild(opt);
    });
    guideSelect.addEventListener('change', () => {
      const target = processingDataDesc.find(x=>x.name===guideSelect.value);
      guideText.textContent = target ? target.description : '';
    });
  })();
</script>

<script>
  // =====================================
  // â–¼ å“ç›®ãƒ‡ãƒ¼ã‚¿ï¼ˆæ–™é‡‘ãƒã‚¹ã‚¿ï¼‰
  // =====================================
  const items = [
    { "name": "éº»ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 750, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": null, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": null },
    { "name": "ã‚¢ãƒ³ãƒ€ãƒ¼ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": null, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": null },
    { "name": "ã‚¦ãƒ¼ãƒ«ä¸¹å‰", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2700, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": null, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": null },
    { "name": "ã‚¦ãƒ¼ãƒ«è‚Œç€ä¸Š", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚¦ãƒ¼ãƒ«è‚Œç€ä¸‹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚¦ã‚§ãƒ‡ã‚£ãƒ³ã‚°ãƒ‰ãƒ¬ã‚¹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": null, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 36000, "ç´ æåˆ¥æ–™é‡‘": null, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": null },
    { "name": "æ‰“æ›", "å’Œæ´—æ–™é‡‘": 26000 },
    { "name": "ç¾½æ¯›å¸ƒå›£", "å¸ƒå›£æ–™é‡‘": 8500, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": null, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": null },
    { "name": "ã‚ªãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒ«ãƒ»ã‚µãƒ­ãƒšãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3600, "ç´ æåˆ¥æ–™é‡‘": 3600, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3600 },
    { "name": "ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³è£åœ°ä»˜ã", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3400, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ã‹ã„ã¾ãæ¯›å¸ƒ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1600, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 3200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3200 },
    { "name": "ã‚¬ã‚¦ãƒ³", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 3700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3700 },
    { "name": "å­¦ç”Ÿæœä¸Šä¸‹(ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ©ãƒƒã‚¯ã‚¹)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 3600, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3600 },
    { "name": "å­¦ç”Ÿæœä¸Šä¸‹(ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ã‚«ãƒ¼ãƒˆ)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 3600, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3600 },
    { "name": "å­¦ç”Ÿæœä¸Šä¸‹(ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¸ãƒ£ãƒ³ãƒ‘ãƒ¼ã‚¹ã‚«ãƒ¼ãƒˆ)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2250, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 4500, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 4500 },
    { "name": "å­¦ç”Ÿæœä¸Šä¸‹(ãƒ™ã‚¹ãƒˆãƒ»ã‚¹ã‚«ãƒ¼ãƒˆ)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 3600, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3600 },
    { "name": "å­¦ç”Ÿæœã‚¸ãƒ£ã‚±ãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1050, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 2100, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 2100 },
    { "name": "å­¦ç”Ÿæœã‚¸ãƒ£ãƒ³ãƒ‘ãƒ¼ã‚¹ã‚«ãƒ¼ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1200, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 2400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 2400 },
    { "name": "å­¦ç”Ÿæœã‚ºãƒœãƒ³", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 750, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1500, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1500 },
    { "name": "å­¦ç”Ÿæœã‚¹ã‚«ãƒ¼ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 750, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1500, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1500 },
    { "name": "å­¦ç”Ÿæœãƒ™ã‚¹ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 600, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1200 },
    { "name": "å­¦ç”Ÿæœãƒªãƒœãƒ³ãƒ»è¶ã‚¿ã‚¤", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 750, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1500, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1500 },
    { "name": "å­¦ç”Ÿæœãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1200, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 2400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 2400 },
    { "name": "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "åŒ–ç¹Šãã‚‚ã®(è¢·)", "å’Œæ´—æ–™é‡‘": 7800 },
    { "name": "åŒ–ç¹Šãã‚‚ã®(å˜)", "å’Œæ´—æ–™é‡‘": 6600 },
    { "name": "ã‚«ãƒƒãƒˆã‚½ãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": null, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ãã‚‚ã®(è¢·)", "å’Œæ´—æ–™é‡‘": 13000 },
    { "name": "ãã‚‚ã®(å˜)", "å’Œæ´—æ–™é‡‘": 11000 },
    { "name": "ã‚³ãƒ¼ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2600, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 5200, "ç´ æåˆ¥æ–™é‡‘": 5200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 5200 },
    { "name": "ã“ãŸã¤å¸ƒå›£", "å¸ƒå›£æ–™é‡‘": 4300 },
    { "name": "ã‚·ãƒ¼ãƒ„ãƒ»ãƒ•ã‚£ãƒƒãƒˆã‚·ãƒ¼ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 750 },
    { "name": "ã‚¸ãƒ¼ãƒ³ã‚º", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 900, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 1800, "ç´ æåˆ¥æ–™é‡‘": 1800, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1800 },
    { "name": "ã‚¸ãƒ£ãƒ³ãƒ‘ãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ã‚¸ãƒ£ã‚±ãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3400, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ã‚»ãƒ¼ã‚¿ãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚»ãƒ¼ã‚¿ãƒ¼é£¾ã‚Šä»˜ã", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1500, "ç´ æåˆ¥æ–™é‡‘": 3000, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3000 },
    { "name": "ã‚·ãƒ§ãƒ¼ãƒ«", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚¹ãƒ¼ãƒ„(ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ã‚«ãƒ¼ãƒˆ)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2600, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 5200, "ç´ æåˆ¥æ–™é‡‘": 5200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 5200 },
    { "name": "ã‚¹ãƒ¼ãƒ„(ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ©ãƒƒã‚¯ã‚¹)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2600, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 5200, "ç´ æåˆ¥æ–™é‡‘": 5200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 5200 },
    { "name": "ã‚¹ãƒ¼ãƒ„ä¸‰æƒ(ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ©ãƒƒã‚¯ã‚¹ãƒ»ãƒ™ã‚¹ãƒˆ)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 3450, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 6900, "ç´ æåˆ¥æ–™é‡‘": 6900, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 6900 },
    { "name": "ã‚¹ã‚¦ã‚§ãƒƒãƒˆã‚·ãƒ£ãƒ„ãƒ»ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚¹ã‚«ãƒ¼ãƒˆ(ãƒŸãƒ‹ãƒ»ã‚¿ã‚¤ãƒˆãƒ»ãƒ•ãƒ¬ã‚¢ãƒ¼)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 900, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 1800, "ç´ æåˆ¥æ–™é‡‘": 1800, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1800 },
    { "name": "ã‚¹ã‚«ãƒ¼ãƒˆ(ãƒã‚­ã‚·ãƒ»ãƒ—ãƒªãƒ¼ãƒ„)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1400, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 2800, "ç´ æåˆ¥æ–™é‡‘": 2800, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 2800 },
    { "name": "ã‚¹ã‚«ãƒ¼ãƒˆ(ç·ãƒ—ãƒªãƒ¼ãƒ„)", "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3200 },
    { "name": "ã‚¹ã‚«ãƒ¼ãƒ•", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã‚¹ãƒ©ãƒƒã‚¯ã‚¹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 900, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 1800, "ç´ æåˆ¥æ–™é‡‘": 1800, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1800 },
    { "name": "ã‚¿ã‚ªãƒ«ã‚±ãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1200 },
    { "name": "ãƒ€ã‚¦ãƒ³ã‚³ãƒ¼ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 4800, "ç´ æåˆ¥æ–™é‡‘": 9600, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 9600 },
    { "name": "ãƒ€ã‚¦ãƒ³ã‚¸ãƒ£ã‚±ãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 3000, "ç´ æåˆ¥æ–™é‡‘": 6000, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 6000 },
    { "name": "ãƒ€ã‚¦ãƒ³ãƒ™ã‚¹ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1900, "ç´ æåˆ¥æ–™é‡‘": 3800, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3800 },
    { "name": "ãƒ€ã‚¦ãƒ³è‚©å½“", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1900 },
    { "name": "ä¸¹å‰æ¯›å¸ƒ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1600, "ç´ æåˆ¥æ–™é‡‘": 3200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3200 },
    { "name": "ä¸¹å‰ç¶¿å…¥ã‚Š", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2600, "ç´ æåˆ¥æ–™é‡‘": 5200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 5200 },
    { "name": "ã¡ã‚ƒã‚“ã¡ã‚ƒã‚“ã“", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700 },
    { "name": "ä¸­æŒ¯è¢–", "å’Œæ´—æ–™é‡‘": 18000 },
    { "name": "Tã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ãƒ‡ãƒ‹ãƒ ã‚¸ãƒ£ã‚±ãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3400, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ç•™è¢–", "å’Œæ´—æ–™é‡‘": 14000 },
    { "name": "é•·ã˜ã‚…ã°ã‚“", "å’Œæ´—æ–™é‡‘": 5500, "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800 },
    { "name": "ãƒ‹ãƒƒãƒˆã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ãƒ‹ãƒƒãƒˆã‚¸ãƒ£ã‚±ãƒƒãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3400, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ãƒ‹ãƒƒãƒˆãƒ™ã‚¹ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ã¬ã„ãã‚‹ã¿", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 2400 },
    { "name": "ãƒã‚¯ã‚¿ã‚¤", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 650, "ç´ æåˆ¥æ–™é‡‘": 1000 },
    { "name": "ãƒ‘ã‚¸ãƒ£ãƒä¸Šä¸‹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700, "ç´ æåˆ¥æ–™é‡‘": 3400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3400 },
    { "name": "ãƒã‚¹ãƒ­ãƒ¼ãƒ–", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1100 },
    { "name": "è‚Œã˜ã‚…ã°ã‚“", "å’Œæ´—æ–™é‡‘": 1800, "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800 },
    { "name": "ãƒãƒ«ã‚­ãƒ¼ã‚»ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚ªã‚¤ãƒ«ãƒ‰ã‚»ãƒ¼ã‚¿ãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1500, "ç´ æåˆ¥æ–™é‡‘": 3000, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3000 },
    { "name": "ãƒãƒ³ã‚«ãƒãƒ¼ãƒ•", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ãƒ”ãƒ­ã‚±ãƒ¼ã‚¹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 600 },
    { "name": "ã²ã‚ˆãä»˜ãç•™è¢–", "å’Œæ´—æ–™é‡‘": 14000 },
    { "name": "å¸ƒå›£ã‚«ãƒãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1000 },
    { "name": "æŒ¯è¢–", "å’Œæ´—æ–™é‡‘": 18000 },
    { "name": "ãƒ™ã‚¹ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 1700, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "è¨ªå•ç€", "å’Œæ´—æ–™é‡‘": 13000 },
    { "name": "ãƒãƒ­ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "å‰ã²ã ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1700 },
    { "name": "ãƒãƒ•ãƒ©ãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 850, "ç´ æåˆ¥æ–™é‡‘": 1700, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 1700 },
    { "name": "ç¶¿ãƒ»åŒ–ç¹Šã‚ãŸå¸ƒå›£", "å¸ƒå›£æ–™é‡‘": 7000 },
    { "name": "æ¯›å¸ƒ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1600, "ç´ æåˆ¥æ–™é‡‘": 3200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3200 },
    { "name": "æ¯›å¸ƒ(äºŒé‡åˆã‚ã›)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 3200, "ç´ æåˆ¥æ–™é‡‘": 6400, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 6400 },
    { "name": "å–ªæœ", "å’Œæ´—æ–™é‡‘": 14000 },
    { "name": "ãƒ­ãƒ¼ãƒ¤ãƒ«ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 750 },
    { "name": "ãƒ­ãƒ³ã‚°ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1500, "ç´ æåˆ¥æ–™é‡‘": 3000, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3000 },
    { "name": "ãƒ­ãƒ³ã‚°ã‚»ãƒ¼ã‚¿ãƒ¼", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1500, "ç´ æåˆ¥æ–™é‡‘": 3000, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3000 },
    { "name": "ãƒ­ãƒ³ã‚°ãƒ‹ãƒƒãƒˆãƒ™ã‚¹ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1500, "ç´ æåˆ¥æ–™é‡‘": 3000, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3000 },
    { "name": "ã‚†ã‹ãŸ(éº»ãƒ»ç¶¿ãƒ»çµ½ãƒ»ç´…æ¢…ç­‰ï¼‰", "å’Œæ´—æ–™é‡‘": 6800 },
    { "name": "ã‚†ã‹ãŸ(å¤–å‡ºç”¨ï¼‰", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 3400, "ç´ æåˆ¥æ–™é‡‘": 6800, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 6800 },
    { "name": "ã‚†ã‹ãŸ(çµã‚Šï¼‰", "å’Œæ´—æ–™é‡‘": 6800 },
    { "name": "ã‚†ã‹ãŸ(å¯å·»ç”¨)", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1050 },
    { "name": "ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 400 },
    { "name": "å’Œæœåœ°ã‚³ãƒ¼ãƒˆ", "ç´ æåˆ¥æ–™é‡‘": 5200, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 5200 },
    { "name": "ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹", "ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘": 1800, "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘": 3600, "ç´ æåˆ¥æ–™é‡‘": 3600, "ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ–™é‡‘": 3600 }
  ];

  const typeSelect = document.getElementById("typeSelect");
  const tableBody = document.getElementById("tableBody");
  const totalSpan = document.getElementById("total");
  const itemSuggestions = document.getElementById("itemSuggestions");

  items.forEach(item => {
    const option = document.createElement("option");
    option.value = item.name; itemSuggestions.appendChild(option);
  });
</script>

<script>
  // ================= Schema v2ï¼ˆè¡Œç®¡ç†ãƒ»ä¿å­˜ï¼‰ =================
  const STORAGE_KEY = "hakuyosha_fee_sim_v2"; // v2: processingå¯¾å¿œ

  function getOriginalPriceByName(name){
    const it = items.find(i => i.name === name);
    return it && typeof it["ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘"] === 'number' ? it["ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘"] : null;
  }

  function getPriceByType(item, typeKey){
    return (item && typeof item[typeKey] === 'number') ? item[typeKey] : null;
  }

  function buildRowData(name, typeKey){
    const item = items.find(i => i.name === name);
    if(!item) return null;
    const basePrice = getPriceByType(item, typeKey);
    if(basePrice == null) return null;
    const originalPrice = getOriginalPriceByName(name);
    return {
      name,
      typeKey,                // ä¾‹: "ãƒ­ãƒ¼ãƒ¤ãƒ«æ–™é‡‘"
      basePrice,              // é¸æŠç¨®åˆ¥ã®åŸºæº–é‡‘é¡
      originalPrice,          // %è¨ˆç®—ã®æ¯ä½“ï¼ˆnullå¯ï¼‰
      processing: [],         // å¾Œã§ç·¨é›†
      processingTotal: 0,
      lineTotal: basePrice
    };
  }

  function saveState(){
    try{
      const rows = Array.from(tableBody.querySelectorAll('tr')).map(tr=>{
        return JSON.parse(tr.dataset.rowjson);
      });
      const state = {
        schemaVersion: 2,
        rows,
        selectedType: typeSelect.value,
        lastSearch: document.getElementById('itemSearch').value || ''
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }catch(e){ console.warn('saveState failed:', e); }
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const state = JSON.parse(raw);
      if(state.selectedType && [...typeSelect.options].some(o=>o.value===state.selectedType)){
        typeSelect.value = state.selectedType;
      }
      const inp = document.getElementById('itemSearch');
      if(inp && typeof state.lastSearch === 'string') inp.value = state.lastSearch;
      if(Array.isArray(state.rows)){
        tableBody.innerHTML = '';
        state.rows.forEach(r=> addRowFromData(r));
        updateTotal();
      }
    }catch(e){ console.warn('loadState failed:', e); }
  }

  function addRowFromData(rowData){
    const tr = document.createElement('tr');
    tr.dataset.rowjson = JSON.stringify(rowData);
    const chipsHtml = renderChips(rowData.processing);
    tr.innerHTML = `
      <td>${rowData.name}</td>
      <td>${rowData.typeKey.replace('æ–™é‡‘','')}</td>
      <td>${rowData.basePrice}</td>
      <td><div class="chips">${chipsHtml} <button class="btn-ghost kbd editProcBtn">åŠ å·¥ã‚’ç·¨é›†</button></div></td>
      <td class="lineTotal">${rowData.lineTotal}</td>
      <td class="actions"><button class="btn-danger deleteBtn">å‰Šé™¤</button></td>
    `;
    tableBody.appendChild(tr);
  }

  function renderChips(processing){
    if(!processing || processing.length===0) return '<span class="hint">ï¼ˆæœªè¨­å®šï¼‰</span>';
    const maxShow = 3;
    const visible = processing.slice(0, maxShow).map(p=>`<span class="chip">${p.name} +${p.amount}</span>`).join('');
    const rest = processing.length - maxShow;
    return rest>0 ? `${visible}<span class="chip">+${rest}</span>` : visible;
  }

  function updateTotal(){
    let total = 0;
    document.querySelectorAll('#tableBody tr').forEach(row => {
      const data = JSON.parse(row.dataset.rowjson);
      total += Number(data.lineTotal)||0;
      row.querySelector('.lineTotal').textContent = Number(data.lineTotal||0);
      const chipWrap = row.querySelector('.chips');
      if(chipWrap){ chipWrap.innerHTML = `${renderChips(data.processing)} <button class="btn-ghost kbd editProcBtn">åŠ å·¥ã‚’ç·¨é›†</button>`; }
    });
    totalSpan.textContent = total.toLocaleString();
    saveState();
  }
</script>

<script>
  // ================= ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆè¿½åŠ ãƒ»å‰Šé™¤ãƒ»ç·¨é›†ï¼‰ =================
  document.getElementById("addSearchBtn").addEventListener("click", () => {
    const name = document.getElementById("itemSearch").value;
    const typeKey = typeSelect.value;
    const data = buildRowData(name, typeKey);
    if(!name || !items.find(i=>i.name===name)) { alert('è©²å½“ã™ã‚‹å“ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); return; }
    if(!data){ alert('ã“ã®ç¨®åˆ¥ã§ã¯é‡‘é¡ãŒæœªè¨­å®šã§ã™ã€‚'); return; }
    addRowFromData(data);
    updateTotal();
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    tableBody.innerHTML = "";
    localStorage.removeItem(STORAGE_KEY);
    updateTotal();
  });

  tableBody.addEventListener("click", (e) => {
    const tr = e.target.closest('tr');
    if(!tr) return;
    if (e.target.classList.contains("deleteBtn")) {
      tr.remove(); updateTotal(); return;
    }
    if (e.target.classList.contains("editProcBtn")) {
      openDrawerForRow(tr); return;
    }
  });

  typeSelect.addEventListener('change', saveState);
  const itemSearchInput = document.getElementById('itemSearch');
  if(itemSearchInput){ itemSearchInput.addEventListener('input', saveState); itemSearchInput.addEventListener('change', saveState); }
</script>

<script>
  // ================= åŠ å·¥ãƒã‚¹ã‚¿ï¼†é©ç”¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆPROC_MASTERï¼‰ =================
  const PROC_MASTER = [
    { code:'P_MOTH', name:'é˜²è™«åŠ å·¥',        calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> row.originalPrice!=null },
    { code:'P_WR',   name:'ã¯ã£æ°´åŠ å·¥',      calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> row.originalPrice!=null },
    { code:'P_SWEAT',name:'æ±—ã™ã£ãã‚ŠåŠ å·¥',  calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> row.originalPrice!=null },
    { code:'P_MOIST',name:'ã—ã£ã¨ã‚ŠåŠ å·¥',    calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> row.originalPrice!=null },
    { code:'P_POLY', name:'ãƒãƒªã‚¸ãƒ³ãƒ»ã‚¦ã‚©ãƒƒã‚·ãƒ¥ã‚¤ãƒ³', calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> row.originalPrice!=null },
    { code:'P_POLY_FUTON', name:'ãƒãƒªã‚¸ãƒ³ï¼ˆãµã¨ã‚“ï¼‰', calcType:'fixed', amount:1500, appliesTo:'none', isApplicable: (row)=> /å¸ƒå›£/.test(row.name) },
    { code:'P_WAFUKU_WR', name:'å’Œæœã¯ã£æ°´åŠ å·¥', calcType:'fixed', amount:3500, appliesTo:'none', isApplicable: (row)=> /ãã‚‚ã®|ç•™è¢–|æŒ¯è¢–|è¨ªå•ç€|é•·ã˜ã‚…ã°ã‚“|ã‚†ã‹ãŸ|æ‰“æ›|å–ªæœ/.test(row.name) || row.typeKey==='å’Œæ´—æ–™é‡‘' },
    { code:'P_FUR_BIG', name:'æ¯›çš®é˜²è™«ï¼ˆã‚³ãƒ¼ãƒˆãƒ»ã‚¸ãƒ£ã‚±ãƒƒãƒˆç­‰ï¼‰', calcType:'fixed', amount:3500, appliesTo:'none', isApplicable: (row)=> /ã‚³ãƒ¼ãƒˆ|ã‚¸ãƒ£ã‚±ãƒƒãƒˆ/.test(row.name) },
    { code:'P_FUR_SMALL', name:'æ¯›çš®é˜²è™«ï¼ˆãƒãƒ•ãƒ©ãƒ¼ãƒ»ã‚·ãƒ§ãƒ¼ãƒ«ç­‰ï¼‰', calcType:'fixed', amount:2500, appliesTo:'none', isApplicable: (row)=> /ãƒãƒ•ãƒ©ãƒ¼|ã‚·ãƒ§ãƒ¼ãƒ«/.test(row.name) },
    { code:'P_MITE_BLANKET', name:'é˜²ãƒ€ãƒ‹ï¼ˆæ¯›å¸ƒï¼š50%ï¼‰', calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> /æ¯›å¸ƒ/.test(row.name) && row.originalPrice!=null },
    { code:'P_MITE_FUTON', name:'é˜²ãƒ€ãƒ‹ï¼ˆãµã¨ã‚“ï¼š1500ï¼‰', calcType:'fixed', amount:1500, appliesTo:'none', isApplicable: (row)=> /å¸ƒå›£/.test(row.name) },
    { code:'P_ANTI_MOLD', name:'é˜²ã‚«ãƒ“ï¼ˆã‚«ãƒ¼ãƒ†ãƒ³ã®ã¿ï¼š50%ï¼‰', calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> /ã‚«ãƒ¼ãƒ†ãƒ³/.test(row.name) && row.originalPrice!=null },
    { code:'P_FLAME', name:'é˜²ç‚ï¼ˆã‚«ãƒ¼ãƒ†ãƒ³ã®ã¿ï¼š50%ï¼‰', calcType:'percent', rate:0.5, min:400, max:2500, appliesTo:'original', isApplicable: (row)=> /ã‚«ãƒ¼ãƒ†ãƒ³/.test(row.name) && row.originalPrice!=null },
    { code:'C_RINTORAKU', name:'ãƒªãƒ³ãƒˆãƒ©ã‚¯', calcType:'conditional', appliesTo:'none', isApplicable: (row)=> /ã‚¹ã‚«ãƒ¼ãƒˆ|ã‚¹ãƒ©ãƒƒã‚¯ã‚¹|ã‚ºãƒœãƒ³/.test(row.name),
      options:[
        { key:'skirt_pleats_3',   label:'ã‚¹ã‚«ãƒ¼ãƒˆ ãƒ’ãƒ€3æœ¬ã¾ã§', amount:800 },
        { key:'skirt_pleats_4_10',label:'ã‚¹ã‚«ãƒ¼ãƒˆ ãƒ’ãƒ€4ã€œ10æœ¬', amount:1000 },
        { key:'skirt_pleats_11_30',label:'ã‚¹ã‚«ãƒ¼ãƒˆ ãƒ’ãƒ€11ã€œ30æœ¬', amount:1500 },
        { key:'pants',            label:'ã‚¹ãƒ©ãƒƒã‚¯ã‚¹ãƒ»ã‚ºãƒœãƒ³', amount:1000 }
      ]
    },
    { code:'C_SHIROSET', name:'ã‚·ãƒ­ã‚»ãƒƒãƒˆ', calcType:'conditional', appliesTo:'none', isApplicable: (row)=> /ã‚¹ãƒ©ãƒƒã‚¯ã‚¹|ã‚ºãƒœãƒ³/.test(row.name),
      options:[ { key:'pants', label:'ã‚·ãƒ­ã‚»ãƒƒãƒˆåŠ å·¥', amount:1000 } ]
    }
  ];

  function computePercent(original, rate, min, max){
    if(original==null) return {amount:0, note:'ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘ãŒæœªè¨­å®šã®ãŸã‚é©ç”¨ä¸å¯'};
    let val = Math.round(original * rate);
    if (typeof min==='number' && val < min) val = min;
    if (typeof max==='number' && val > max) val = max;
    return {amount: val, note:`ã‚ªãƒªã‚¸ãƒŠãƒ«${original}Ã—${Math.round(rate*100)}%ï¼ˆä¸‹é™/ä¸Šé™é©ç”¨ï¼‰`};
  }
</script>

<script>
  // ================= ãƒ‰ãƒ­ãƒ¯ãƒ¼åˆ¶å¾¡ =================
  const drawer = document.getElementById('drawer');
  const overlay = document.getElementById('drawerOverlay');
  const drawerClose = document.getElementById('drawerClose');
  const drawerCancel = document.getElementById('drawerCancel');
  const drawerSave = document.getElementById('drawerSave');

  let currentRowEl = null;

  function openDrawerForRow(tr){
    currentRowEl = tr;
    const data = JSON.parse(tr.dataset.rowjson);
    document.getElementById('drawerTitle').textContent = 'åŠ å·¥ã®ç·¨é›†';
    document.getElementById('drawerSubtitle').textContent = `${data.name}ï¼ˆç¨®åˆ¥ï¼š${data.typeKey.replace('æ–™é‡‘','')}ï¼‰`;
    const baseNote = (data.originalPrice!=null)
      ? `ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘ï¼š<strong>${data.originalPrice} å††</strong> ï¼ åŸºæº–é‡‘é¡ï¼ˆ${data.typeKey.replace('æ–™é‡‘','')}ï¼‰ï¼š<strong>${data.basePrice} å††</strong>`
      : `ã‚ªãƒªã‚¸ãƒŠãƒ«æ–™é‡‘ï¼š<strong>æœªè¨­å®š</strong>ï¼ˆï¼…ç³»åŠ å·¥ã¯ç„¡åŠ¹ï¼‰ ï¼ åŸºæº–é‡‘é¡ï¼ˆ${data.typeKey.replace('æ–™é‡‘','')}ï¼‰ï¼š<strong>${data.basePrice} å††</strong>`;
    document.getElementById('drawerBaseInfo').innerHTML = baseNote;

    renderProcessingUI(data);
    recalcDrawerTotals();

    overlay.style.display = 'block';
    setTimeout(()=>{ drawer.classList.add('open'); }, 10);
  }

  function closeDrawer(){
    drawer.classList.remove('open');
    setTimeout(()=>{ overlay.style.display = 'none'; currentRowEl=null; }, 200);
  }

  overlay.addEventListener('click', closeDrawer);
  drawerClose.addEventListener('click', closeDrawer);
  drawerCancel.addEventListener('click', closeDrawer);

  function renderProcessingUI(row){
    const percentWrap = document.getElementById('procPercentList');
    const fixedWrap = document.getElementById('procFixedList');
    const condWrap = document.getElementById('procConditionalList');
    percentWrap.innerHTML = ''; fixedWrap.innerHTML=''; condWrap.innerHTML='';

    const selected = new Map(row.processing.map(p=>[p.code,p]));

    PROC_MASTER.forEach(def => {
      if(!def.isApplicable(row)) return;
      if(def.calcType==='percent' || def.calcType==='fixed'){
        const isChecked = selected.has(def.code);
        const amount = isChecked ? selected.get(def.code).amount : estimateAmount(def, row).amount;
        const note = isChecked ? (selected.get(def.code).note||'') : (estimateAmount(def,row).note||'');
        const node = document.createElement('div');
        node.className = 'proc-row';
        node.innerHTML = `
          <div>
            <label style="display:flex; gap:8px; align-items:center;">
              <input type="checkbox" data-proc-code="${def.code}" ${isChecked? 'checked':''} />
              <span>${def.name}</span>
            </label>
            <div class="proc-meta">${note? note : ''}</div>
          </div>
          <div class="proc-controls">+ <span class="amount" data-amt-for="${def.code}">${amount}</span> å††</div>
        `;
        (def.calcType==='percent' ? percentWrap : fixedWrap).appendChild(node);
      } else if(def.calcType==='conditional'){
        const chosen = selected.get(def.code)?.optionKey || '';
        const node = document.createElement('div'); node.className='proc-row';
        const opts = def.options.map(o=>`<option value="${o.key}" ${o.key===chosen?'selected':''}>${o.label}ï¼ˆ+${o.amount}å††ï¼‰</option>`).join('');
        node.innerHTML = `
          <div>
            <label style="display:flex; gap:8px; align-items:center;">
              <input type="checkbox" data-proc-code="${def.code}" ${chosen? 'checked':''} />
              <span>${def.name}</span>
            </label>
            <div class="proc-meta">æ¡ä»¶ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
          </div>
          <div class="proc-controls">
            <select data-proc-opt="${def.code}">
              <option value="">æœªé¸æŠ</option>
              ${opts}
            </select>
          </div>
        `;
        condWrap.appendChild(node);
      }
    });

    document.querySelectorAll('[data-proc-code]').forEach(el=>{
      el.addEventListener('change', ()=>{ recalcDrawerTotals(); });
    });
    document.querySelectorAll('[data-proc-opt]').forEach(el=>{
      el.addEventListener('change', ()=>{ const cb = el.closest('.proc-row').querySelector('[data-proc-code]'); if(el.value) cb.checked=true; recalcDrawerTotals(); });
    });
  }

  function estimateAmount(def, row){
    if(def.calcType==='fixed') return {amount:def.amount, note:''};
    if(def.calcType==='percent') return computePercent(row.originalPrice, def.rate, def.min, def.max);
    return {amount:0, note:''};
  }

  function gatherDrawerSelection(){
    if(!currentRowEl) return [];
    const data = JSON.parse(currentRowEl.dataset.rowjson);
    const out = [];

    PROC_MASTER.forEach(def=>{
      if(!def.isApplicable(data)) return;
      if(def.calcType==='percent' || def.calcType==='fixed'){
        const cb = document.querySelector(`[data-proc-code="${def.code}"]`);
        if(cb && cb.checked){
          const est = estimateAmount(def, data);
          out.push({ code:def.code, name:def.name, calcType:def.calcType, amount: est.amount, note: est.note });
        }
      }
    });
    PROC_MASTER.filter(d=>d.calcType==='conditional' && d.isApplicable(data)).forEach(def=>{
      const cb = document.querySelector(`[data-proc-code="${def.code}"]`);
      const sel = document.querySelector(`[data-proc-opt="${def.code}"]`);
      if(cb && cb.checked && sel && sel.value){
        const opt = def.options.find(o=>o.key===sel.value);
        if(opt) out.push({ code:def.code, name:def.name, calcType:'conditional', amount: opt.amount, optionKey: opt.key, optionLabel: opt.label });
      }
    });
    return out;
  }

  function recalcDrawerTotals(){
    if(!currentRowEl) return;
    const data = JSON.parse(currentRowEl.dataset.rowjson);
    const selected = gatherDrawerSelection();
    const procSum = selected.reduce((s,p)=> s + (Number(p.amount)||0), 0);
    const lineTotal = (Number(data.basePrice)||0) + procSum;
    document.getElementById('procSubtotal').textContent = procSum;
    document.getElementById('rowLineTotal').textContent = lineTotal;
  }

  drawerSave.addEventListener('click', ()=>{
    if(!currentRowEl) return;
    const selected = gatherDrawerSelection();
    const data = JSON.parse(currentRowEl.dataset.rowjson);
    const procSum = selected.reduce((s,p)=> s + (Number(p.amount)||0), 0);
    data.processing = selected;
    data.processingTotal = procSum;
    data.lineTotal = (Number(data.basePrice)||0) + procSum;
    currentRowEl.dataset.rowjson = JSON.stringify(data);
    updateTotal();
    closeDrawer();
  });
</script>

<script>
  // ================= åˆæœŸåŒ– =================
  (function init(){
    loadState();
  })();
</script>

<script>
  // ================= æœ€å°ãƒ†ã‚¹ãƒˆï¼ˆé–‹ç™ºè€…å‘ã‘ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰ =================
  (function selfTest(){
    try{
      console.group('%cSelfTest','color:#0b6dd6;font-weight:bold');
      console.assert(typeof processingDataDesc !== 'undefined' && processingDataDesc.length > 0, 'processingDataDesc ãŒç©º');
      console.assert(Array.isArray(items) && items.length > 0, 'items ãŒæœªå®šç¾©ã¾ãŸã¯ç©º');
      console.assert(typeof computePercent === 'function', 'computePercent æœªå®šç¾©');
      // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
      console.assert(computePercent(1000,0.5,400,2500).amount === 500, '50%åŸºæœ¬è¨ˆç®— NG');
      console.assert(computePercent(100,0.5,400,2500).amount === 400, 'ä¸‹é™400é©ç”¨ NG');
      console.assert(computePercent(10000,0.5,400,2500).amount === 2500, 'ä¸Šé™2500é©ç”¨ NG');
      console.assert(PROC_MASTER.find(p=>p.name==='ãƒªãƒ³ãƒˆãƒ©ã‚¯') && PROC_MASTER.find(p=>p.name==='ã‚·ãƒ­ã‚»ãƒƒãƒˆ'), 'æŠ˜ã‚Šç›®åŠ å·¥ å®šç¾©NG');
      console.log('âœ… SelfTest OK');
    }catch(err){
      console.error('âŒ SelfTest å¤±æ•—', err);
    }finally{
      console.groupEnd();
    }
  })();
</script>
</body>
</html>
